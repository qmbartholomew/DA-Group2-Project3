let list = [
    {
      " Close": 1.0359,
      " High": 1.0364,
      " Low": 1.0352,
      " Open": 1.0356,
      "Date": "01/01/25"
    },
    {
      " Close": 1.0355,
      " High": 1.0426,
      " Low": 1.0345,
      " Open": 1.0409,
      "Date": "12/31/24"
    },
    {
      " Close": 1.0408,
      " High": 1.0459,
      " Low": 1.0373,
      " Open": 1.0427,
      "Date": "12/30/24"
    },
    {
      " Close": 1.0428,
      " High": 1.0446,
      " Low": 1.0406,
      " Open": 1.0419,
      "Date": "12/27/24"
    },
    {
      " Close": 1.0425,
      " High": 1.0432,
      " Low": 1.0381,
      " Open": 1.0407,
      "Date": "12/26/24"
    },
    {
      " Close": 1.0411,
      " High": 1.0413,
      " Low": 1.0398,
      " Open": 1.0401,
      "Date": "12/25/24"
    },
    {
      " Close": 1.04,
      " High": 1.0413,
      " Low": 1.0384,
      " Open": 1.0406,
      "Date": "12/24/24"
    },
    {
      " Close": 1.0407,
      " High": 1.0449,
      " Low": 1.0385,
      " Open": 1.0433,
      "Date": "12/23/24"
    },
    {
      " Close": 1.043,
      " High": 1.045,
      " Low": 1.0342,
      " Open": 1.0364,
      "Date": "12/20/24"
    },
    {
      " Close": 1.0362,
      " High": 1.043,
      " Low": 1.0332,
      " Open": 1.0356,
      "Date": "12/19/24"
    },
    {
      " Close": 1.0355,
      " High": 1.0515,
      " Low": 1.0345,
      " Open": 1.0492,
      "Date": "12/18/24"
    },
    {
      " Close": 1.0493,
      " High": 1.0535,
      " Low": 1.0478,
      " Open": 1.0513,
      "Date": "12/17/24"
    },
    {
      " Close": 1.0514,
      " High": 1.0527,
      " Low": 1.0475,
      " Open": 1.0501,
      "Date": "12/16/24"
    },
    {
      " Close": 1.0502,
      " High": 1.0526,
      " Low": 1.0454,
      " Open": 1.0469,
      "Date": "12/13/24"
    },
    {
      " Close": 1.0467,
      " High": 1.0533,
      " Low": 1.0465,
      " Open": 1.0495,
      "Date": "12/12/24"
    },
    {
      " Close": 1.0497,
      " High": 1.0541,
      " Low": 1.048,
      " Open": 1.0529,
      "Date": "12/11/24"
    },
    {
      " Close": 1.053,
      " High": 1.057,
      " Low": 1.0498,
      " Open": 1.0554,
      "Date": "12/10/24"
    },
    {
      " Close": 1.0555,
      " High": 1.0596,
      " Low": 1.0533,
      " Open": 1.0576,
      "Date": "12/09/24"
    },
    {
      " Close": 1.0569,
      " High": 1.063,
      " Low": 1.0542,
      " Open": 1.0587,
      "Date": "12/06/24"
    },
    {
      " Close": 1.059,
      " High": 1.0592,
      " Low": 1.0508,
      " Open": 1.0511,
      "Date": "12/05/24"
    },
    {
      " Close": 1.0512,
      " High": 1.0545,
      " Low": 1.0473,
      " Open": 1.0509,
      "Date": "12/04/24"
    },
    {
      " Close": 1.051,
      " High": 1.0536,
      " Low": 1.048,
      " Open": 1.0499,
      "Date": "12/03/24"
    },
    {
      " Close": 1.0498,
      " High": 1.058,
      " Low": 1.0461,
      " Open": 1.058,
      "Date": "12/02/24"
    },
    {
      " Close": 1.0579,
      " High": 1.0598,
      " Low": 1.053,
      " Open": 1.0552,
      "Date": "11/29/24"
    },
    {
      " Close": 1.0554,
      " High": 1.0573,
      " Low": 1.0529,
      " Open": 1.0567,
      "Date": "11/28/24"
    },
    {
      " Close": 1.0569,
      " High": 1.059,
      " Low": 1.0474,
      " Open": 1.0488,
      "Date": "11/27/24"
    },
    {
      " Close": 1.0491,
      " High": 1.0547,
      " Low": 1.0426,
      " Open": 1.0494,
      "Date": "11/26/24"
    },
    {
      " Close": 1.0497,
      " High": 1.0532,
      " Low": 1.0417,
      " Open": 1.0417,
      "Date": "11/25/24"
    },
    {
      " Close": 1.0427,
      " High": 1.05,
      " Low": 1.0335,
      " Open": 1.0475,
      "Date": "11/22/24"
    },
    {
      " Close": 1.0474,
      " High": 1.0556,
      " Low": 1.0462,
      " Open": 1.0543,
      "Date": "11/21/24"
    },
    {
      " Close": 1.0546,
      " High": 1.0612,
      " Low": 1.0508,
      " Open": 1.0595,
      "Date": "11/20/24"
    },
    {
      " Close": 1.0596,
      " High": 1.0604,
      " Low": 1.0526,
      " Open": 1.0599,
      "Date": "11/19/24"
    },
    {
      " Close": 1.0598,
      " High": 1.061,
      " Low": 1.0531,
      " Open": 1.0548,
      "Date": "11/18/24"
    },
    {
      " Close": 1.054,
      " High": 1.0595,
      " Low": 1.0516,
      " Open": 1.0532,
      "Date": "11/15/24"
    },
    {
      " Close": 1.0531,
      " High": 1.0584,
      " Low": 1.0498,
      " Open": 1.0567,
      "Date": "11/14/24"
    },
    {
      " Close": 1.0564,
      " High": 1.0655,
      " Low": 1.0556,
      " Open": 1.0624,
      "Date": "11/13/24"
    },
    {
      " Close": 1.0623,
      " High": 1.0666,
      " Low": 1.0595,
      " Open": 1.0655,
      "Date": "11/12/24"
    },
    {
      " Close": 1.0655,
      " High": 1.073,
      " Low": 1.0629,
      " Open": 1.0724,
      "Date": "11/11/24"
    },
    {
      " Close": 1.0719,
      " High": 1.081,
      " Low": 1.0688,
      " Open": 1.0805,
      "Date": "11/08/24"
    },
    {
      " Close": 1.0803,
      " High": 1.0828,
      " Low": 1.0713,
      " Open": 1.073,
      "Date": "11/07/24"
    },
    {
      " Close": 1.0731,
      " High": 1.094,
      " Low": 1.0683,
      " Open": 1.0931,
      "Date": "11/06/24"
    },
    {
      " Close": 1.0932,
      " High": 1.0938,
      " Low": 1.0873,
      " Open": 1.0879,
      "Date": "11/05/24"
    },
    {
      " Close": 1.0878,
      " High": 1.0917,
      " Low": 1.087,
      " Open": 1.0881,
      "Date": "11/04/24"
    },
    {
      " Close": 1.0835,
      " High": 1.0908,
      " Low": 1.0832,
      " Open": 1.0883,
      "Date": "11/01/24"
    },
    {
      " Close": 1.0884,
      " High": 1.0891,
      " Low": 1.0843,
      " Open": 1.0857,
      "Date": "10/31/24"
    },
    {
      " Close": 1.0857,
      " High": 1.0874,
      " Low": 1.0798,
      " Open": 1.0818,
      "Date": "10/30/24"
    },
    {
      " Close": 1.0819,
      " High": 1.0828,
      " Low": 1.077,
      " Open": 1.0813,
      "Date": "10/29/24"
    },
    {
      " Close": 1.0814,
      " High": 1.0829,
      " Low": 1.0781,
      " Open": 1.0803,
      "Date": "10/28/24"
    },
    {
      " Close": 1.0796,
      " High": 1.0841,
      " Low": 1.0794,
      " Open": 1.083,
      "Date": "10/25/24"
    },
    {
      " Close": 1.0828,
      " High": 1.0833,
      " Low": 1.0772,
      " Open": 1.0784,
      "Date": "10/24/24"
    },
    {
      " Close": 1.0782,
      " High": 1.0809,
      " Low": 1.0761,
      " Open": 1.0798,
      "Date": "10/23/24"
    },
    {
      " Close": 1.08,
      " High": 1.0849,
      " Low": 1.0793,
      " Open": 1.0816,
      "Date": "10/22/24"
    },
    {
      " Close": 1.0817,
      " High": 1.0877,
      " Low": 1.0811,
      " Open": 1.0877,
      "Date": "10/21/24"
    },
    {
      " Close": 1.0869,
      " High": 1.0872,
      " Low": 1.0825,
      " Open": 1.0828,
      "Date": "10/18/24"
    },
    {
      " Close": 1.0832,
      " High": 1.0876,
      " Low": 1.0813,
      " Open": 1.0862,
      "Date": "10/17/24"
    },
    {
      " Close": 1.0861,
      " High": 1.0926,
      " Low": 1.0854,
      " Open": 1.0893,
      "Date": "10/16/24"
    },
    {
      " Close": 1.0892,
      " High": 1.0946,
      " Low": 1.0882,
      " Open": 1.0908,
      "Date": "10/15/24"
    },
    {
      " Close": 1.0911,
      " High": 1.0952,
      " Low": 1.089,
      " Open": 1.0952,
      "Date": "10/14/24"
    },
    {
      " Close": 1.0938,
      " High": 1.0956,
      " Low": 1.0923,
      " Open": 1.0934,
      "Date": "10/11/24"
    },
    {
      " Close": 1.0938,
      " High": 1.0957,
      " Low": 1.09,
      " Open": 1.0939,
      "Date": "10/10/24"
    },
    {
      " Close": 1.094,
      " High": 1.0984,
      " Low": 1.0936,
      " Open": 1.0976,
      "Date": "10/09/24"
    },
    {
      " Close": 1.0981,
      " High": 1.1,
      " Low": 1.095,
      " Open": 1.0977,
      "Date": "10/08/24"
    },
    {
      " Close": 1.0976,
      " High": 1.099,
      " Low": 1.0955,
      " Open": 1.0982,
      "Date": "10/07/24"
    },
    {
      " Close": 1.0977,
      " High": 1.1041,
      " Low": 1.0952,
      " Open": 1.1034,
      "Date": "10/04/24"
    },
    {
      " Close": 1.1033,
      " High": 1.1079,
      " Low": 1.1009,
      " Open": 1.1046,
      "Date": "10/03/24"
    },
    {
      " Close": 1.1044,
      " High": 1.1084,
      " Low": 1.1033,
      " Open": 1.1071,
      "Date": "10/02/24"
    },
    {
      " Close": 1.1067,
      " High": 1.1146,
      " Low": 1.1046,
      " Open": 1.1127,
      "Date": "10/01/24"
    },
    {
      " Close": 1.1137,
      " High": 1.1211,
      " Low": 1.1116,
      " Open": 1.1173,
      "Date": "09/30/24"
    },
    {
      " Close": 1.1165,
      " High": 1.1204,
      " Low": 1.1102,
      " Open": 1.1179,
      "Date": "09/27/24"
    },
    {
      " Close": 1.1178,
      " High": 1.1219,
      " Low": 1.1126,
      " Open": 1.1133,
      "Date": "09/26/24"
    },
    {
      " Close": 1.1134,
      " High": 1.1216,
      " Low": 1.1121,
      " Open": 1.1178,
      "Date": "09/25/24"
    },
    {
      " Close": 1.118,
      " High": 1.1184,
      " Low": 1.1103,
      " Open": 1.112,
      "Date": "09/24/24"
    }
  ];

  
  // Format it to remove extra spaces and extract only what we need
  let data = list.map(d => ({
    date: d.Date,
    price: d[" Close"]
  }));
  
  // Sort by date (oldest to newest)
  data.sort((a, b) => new Date(a.date) - new Date(b.date));
  
  // Moving Average calculator
  function calculateMA(data, period) {
    let ma = [];
    for (let i = 0; i < data.length; i++) {
      if (i < period - 1) {
        ma.push(null);
      } else {
        let window = data.slice(i - period + 1, i + 1).map(d => d.price);
        let avg = window.reduce((sum, val) => sum + val, 0) / period;
        ma.push(avg);
      }
    }
    return ma;
  }
  
  // Extract date and price arrays
  let dates = data.map(d => d.date);
  let prices = data.map(d => d.price);
  
  // Calculate 5, 8, 13-day MAs
  let ma5 = calculateMA(data, 5);
  let ma8 = calculateMA(data, 8);
  let ma13 = calculateMA(data, 13);
  
  // Lists for crossover points
  let buyDates = [];
  let buyPrices = [];
  let sellDates = [];
  let sellPrices = [];

  for (let i = 1; i < prices.length; i++) {
    if (ma5[i] && ma8[i] && ma13[i]) {
    const isBullishNow = ma5[i] > ma8[i] && ma8[i] > ma13[i];
    const wasBullishBefore = ma5[i - 1] > ma8[i - 1] && ma8[i - 1] > ma13[i - 1];

    const isBearishNow = ma5[i] < ma8[i] && ma8[i] < ma13[i];
    const wasBearishBefore = ma5[i - 1] < ma8[i - 1] && ma8[i - 1] < ma13[i - 1];

      if (isBullishNow && !wasBullishBefore) {
      buyDates.push(dates[i]);
      buyPrices.push(prices[i]);
      } else if (isBearishNow && !wasBearishBefore) {
      sellDates.push(dates[i]);
      sellPrices.push(prices[i]);
      }
    }
  }


  // Plotly chart setup
  let traces = [
    {
      x: dates,
      y: prices,
      name: 'EUR/USD Price',
      mode: 'lines+markers',
      line: { color: 'black' }
    },
    {
      x: dates,
      y: ma5,
      name: '5-Day MA',
      mode: 'lines',
      line: { color: 'blue' }
    },
    {
      x: dates,
      y: ma8,
      name: '8-Day MA',
      mode: 'lines',
      line: { color: 'orange' }
    },
    {
      x: dates,
      y: ma13,
      name: '13-Day MA',
      mode: 'lines',
      line: { color: 'red' }
    }  
  ];

//Pushes buy and sell triangle markers to the line chart
  traces.push(
    {
      x: buyDates,
      y: buyPrices,
      name: 'BUY Signal',
      mode: 'markers+text',
      marker: { color: 'green', size: 10, symbol: 'triangle-up' },
      text: Array(buyDates.length).fill('BUY'),
      textposition: 'top center'
    },
    {
      x: sellDates,
      y: sellPrices,
      name: 'SELL Signal',
      mode: 'markers+text',
      marker: { color: 'red', size: 10, symbol: 'triangle-down' },
      text: Array(sellDates.length).fill('SELL'),
      textposition: 'bottom center'
    }
  );
  
  let layout = {
    title: 'EUR/USD with 5-8-13 Moving Averages',
    xaxis: { title: 'Date' },
    yaxis: { title: 'Price' }
  };
  
  // Render chart
  Plotly.newPlot('chart', traces, layout);
  
  // Dummy buy/sell signals with calculated returns already
const bullishReturns = [1.2, 0.8, -0.5, 2.1]; // % change from buy to sell
const bearishReturns = [-0.7, 1.5, -0.3];     // % from short to cover

// Calculate averages
const avg = arr => arr.reduce((a, b) => a + b, 0) / arr.length;
const avgBullish = bullishReturns.length ? avg(bullishReturns).toFixed(2) : 0;
const avgBearish = bearishReturns.length ? avg(bearishReturns).toFixed(2) : 0;

// Win/Loss classification
const allReturns = [...bullishReturns, ...bearishReturns];
const wins = allReturns.filter(r => r > 0).length;
const losses = allReturns.filter(r => r <= 0).length;

// ðŸ“Š Bar Chart 1: Avg Return After Crossovers
Plotly.newPlot('avgReturnChart', [{
  x: ['Bullish Crossover', 'Bearish Crossover'],
  y: [avgBullish, avgBearish],
  type: 'bar',
  marker: { color: ['green', 'red'] }
}], {
  title: 'Average Return After Crossovers',
  yaxis: { title: 'Return (%)' }
});

// ðŸ“Š Bar Chart 2: Win vs. Loss Count
Plotly.newPlot('winLossChart', [{
  x: ['Winning Trades', 'Losing Trades'],
  y: [wins, losses],
  type: 'bar',
  marker: { color: ['green', 'red'] }
}], {
  title: 'Win vs. Loss Count',
  yaxis: { title: 'Number of Trades' }
});
