let list = [
    {
      " Open": 1.4387,
      " High": 1.4407,
      " Low": 1.4381,
      " Close": 1.4392,
      "Date": "01/01/25"
    },
    {
      " Open": 1.4359,
      " High": 1.4412,
      " Low" : 1.4339,
      " Close": 1.4385,
      "Date": "12/31/24"
    },
    {
      " Open": 1.4421,
      " High": 1.4432,
      " Low": 1.4345,
      " Close": 1.4357,
      "Date": "12/30/24"
    },
    {
      " Open": 1.4407,
      " High": 1.4450,
      " Low": 1.4376,
      " Close": 1.4413,
      "Date": "12/27/24"
    },
    {
      " Open": 1.4379,
      " High": 1.4423,
      " Low": 1.4349,
      " Close": 1.4408,
      "Date": "12/26/24"
    },
    {
      " Open": 1.4358,
      " High": 1.4431,
      " Low": 1.4327,
      " Close": 1.4391,
      "Date": "12/25/24"
    },
    {
      " Open": 1.4364,
      " High": 1.4422,
      " Low": 1.4348,
      " Close": 1.4359,
      "Date": "12/24/24"
    },
    {
      " Open": 1.4325,
      " high": 1.4436,
      " Low": 1.4325,
      " Close": 1.4372,
      "Date": "12/23/24"
    },
    {
      " Open": 1.4401,
      " High": 1.4438,
      " Low": 1.4336,
      " Close": 1.4378,
      "Date": "12/20/24"
    },
    {
      " Open": 1.4447,
      " High": 1.4467,
      " Low": 1.4345,
      " Close": 1.4399,
      "Date": "12/19/24"
    },
    {
      " Open": 1.4313,
      " High": 1.4451,
      " Low": 1.4304,
      " Close": 1.4449,
      "Date": "12/18/24"
    },
    {
      " Open": 1.4244,
      " High": 1.4326,
      " Low": 1.4231,
      " Close": 1.4311,
      "Date": "12/17/24"
    },
    {
      " Open": 1.4240,
      " High": 1.4272,
      " Low": 1.4218,
      " Close": 1.4242,
      "Date": "12/16/24"
    },
    {
      " Open": 1.4222,
      " High": 1.4247,
      " Low": 1.4204,
      " Close": 1.4236,
      "Date": "12/13/24"
    },
    {
      " Open": 1.4159,
      " High": 1.4230,
      " Low": 1.4131,
      " Close": 1.4220,
      "Date": "12/12/24"
    },
    {
      " Open": 1.4183,
      " High": 1.4196,
      " Low": 1.4120,
      " Close": 1.4161,
      "Date": "12/11/24"
    },
    {
      " Open": 1.4171,
      " High": 1.4197,
      " Low": 1.4156,
      " Close": 1.4181,
      "Date": "12/10/24"
    },
    {
      " Open": 1.4162,
      " High": 1.4177,
      " Low": 1.4095,
      " Close": 1.41726,
      "Date": "12/09/24"
    },
    {
      " Open": 1.4024,
      " High": 1.4166,
      " Low": 1.4018,
      " Close": 1.4159,
      "Date": "12/06/24"
    },
    {
      " Open": 1.4077,
      " High": 1.4083,
      " Low": 1.4010,
      " Close": 1.4025,
      "Date": "12/05/24"
    },
    {
      " Open": 1.4068,
      " High": 1.4084,
      " Low": 1.4053,
      " Close": 1.4074,
      "Date": "12/04/24"
    },
    {
      " Open": 1.4046,
      " High": 1.4079,
      " Low": 1.4010,
      " Close": 1.4071,
      "Date": "12/03/24"
    },
    {
      " Open": 1.4019,
      " High": 1.4092,
      " Low": 1.3988,
      " Close": 1.4048,
      "Date": "12/02/24"
    },
    {
      " Open": 1.4019,
      " High": 1.4047,
      " Low": 1.3981,
      " Close": 1.4027,
      "Date": "11/29/24"
    },
    {
      " Open": 1.4029,
      " High": 1.4043,
      " Low": 1.3999,
      " Close": 1.4016,
      "Date": "11/28/24"
    },
    {
      " Open": 1.4062,
      " High": 1.4081,
      " Low": 1.4009,
      " Close": 1.4030,
      "Date": "11/27/24"
    },
    {
      " Open": 1.3985,
      " High": 1.4181,
      " Low": 1.3982,
      " Closer": 1.4056,
      "Date": "11/26/24"
    },
    {
      " Open": 1.3982,
      " High": 1.4009,
      " Low": 1.3927,
      " Close": 1.3986,
      "Date": "11/25/24"
    },
    {
      " Open": 1.3970,
      " High": 1.4021,
      " Low": 1.3944,
      " Close": 1.3961,
      "Date": "11/22/24"
    },
    {
      " Open": 1.3977,
      " High": 1.3981,
      " Low": 1.3932,
      " Close": 1.3975,
      "Date": "11/21/24"
    },
    {
      " Open": 1.3958,
      " High": 1.4017,
      " Low": 1.3950,
      " Close": 1.3976,
      "Date": "11/20/24"
    },
    {
      " Open": 1.4014,
      " High": 1.4039,
      " Low": 1.3956,
      " Close": 1.3957,
      "Date": "11/19/24"
    },
    {
      " Open": 1.4103,
      " High": 1.4105,
      " Low": 1.4004,
      " Close": 1.4016,
      "Date": "11/18/24"
    },
    {
      " Open": 1.4061,
      " High": 1.4107,
      " Low": 1.4034,
      " Close": 1.4090,
      "Date": "11/15/24"
    },
    {
      " Open": 1.3998,
      " High": 1.4067,
      " Low": 1.3987,
      " Close": 1.4062,
      "Date": "11/14/24"
    },
    {
      " Open": 1.3944,
      " High": 1.4006,
      " Low": 1.3933,
      " Close": 1.4002,
      "Date": "11/13/24"
    },
    {
      " Open": 1.3925,
      " High": 1.3969,
      " Low": 1.3918,
      " Close": 1.3945,
      "Date": "11/12/24"
    },
    {
      " Open": 1.3919,
      " High": 1.3954,
      " Low": 1.3898,
      " Close": 1.3924,
      "Date": "11/11/24"
    },
    {
      " Open": 1.3861,
      " High": 1.3929,
      " Low": 1.3848,
      " Close": 1.3915,
      "Date": "11/08/24"
    },
    {
      " Open": 1.3940,
      " High": 1.3950,
      " Low": 1.3842,
      " Close": 1.3863,
      "Date": "11/07/24"
    },
    {
      " Open": 1.3825,
      " High": 1.3961,
      " Low": 1.3822,
      " Close": 1.3941,
      "Date": "11/06/24"
    },
    {
      " Open": 1.3897,
      " High": 1.3910,
      " Low": 1.3823,
      " Close": 1.3826,
      "Date": "11/05/24"
    },
    {
      " Open": 1.3967,
      " High": 1.3967,
      " Low": 1.3875,
      " Close": 1.3902,
      "Date": "11/04/24"
    },
    {
      " Open": 1.3934,
      " High": 1.3991,
      " Low":  1.3902,
      " Close": 1.3961,
      "Date": "11/01/24"
    },
    {
      " Open": 1.3905,
      " High": 1.3947,
      " Low": 1.3892,
      " Close": 1.3935,
      "Date": "10/31/24"
    },
    {
      " Open": 1.3916,
      " High": 1.3942,
      " Low": 1.3895,
      " Close": 1.3904,
      "Date": "10/30/24"
    },
    {
      " Open": 1.3894,
      " High": 1.3932,
      " Low": 1.3877,
      " Close": 1.3915,
      "Date": "10/29/24"
    },
    {
      " Open": 1.3895,
      " High": 1.3909,
      " Low": 1.3882,
      " Close": 1.3889,
      "Date": "10/28/24"
    },
    {
      " Open": 1.3857,
      " High": 1.3900,
      " Low": 1.3839,
      " close": 1.3894,
      "Date": "10/25/24"
    },
    {
      " Open": 1.3837,
      " High": 1.3870,
      " Low": 1.3813,
      " Close": 1.3856,
      "Date": "10/24/24"
    },
    {
      " Open": 1.3818,
      " High": 1.3865,
      " Low": 1.3816,
      " Close": 1.3838,
      "Date": "10/23/24"
    },
    {
      " Open": 1.3841,
      " High": 1.3841,
      " Low": 1.3814,
      " Close": 1.3819,
      "Date": "10/22/24"
    },
    {
      " Open": 1.3815,
      " High": 1.3852,
      " Low": 1.3800,
      " Close": 1.3830,
      "Date": "10/21/24"
    },
    {
      " Open": 1.3796,
      " High": 1.3818,
      " Low": 1.3785,
      " Close": 1.3802,
      "Date": "10/18/24"
    },
    {
      " Open": 1.3751,
      " High": 1.3803,
      " Low": 1.3747,
      " Close": 1.3798,
      "Date": "10/17/24"
    },
    {
      " Open": 1.3775,
      " High": 1.3796,
      " Low": 1.3749,
      " Close": 1.3753,
      "Date": "10/16/24"
    },
    {
      " Open": 1.3798,
      " High": 1.3841,
      " Low": 1.3771,
      " Close": 1.3776,
      "Date": "10/15/24"
    },
    {
      " Open": 1.3773,
      " High": 1.3807,
      " Low": 1.3758,
      " Close": 1.3797,
      "Date": "10/14/24"
    },
    {
      " Open": 1.3740,
      " High": 1.3785,
      " Low": 1.3725,
      " Close": 1.3763,
      "Date": "10/11/24"
    },
    {
      " Open": 1.3711,
      " High": 1.3777,
      " Low": 1.3696,
      " Close": 1.3741,
      "Date": "10/10/24"
    },
    {
      " Open": 1.3647,
      " High":.3720,
      " Low": 1.3642,
      " Close": 1.3713,
      "Date": "10/09/24"
    },
    {
      " Open": 1.3619,
      " High": 1.3678,
      " Low": 1.3612,
      " Close": 1.3648,
      "Date": "10/08/24"
    },
    {
      " Open": 1.3581,
      " High": 1.3640,
      " Low": 1.3567,
      " Close": 1.3620,
      "Date": "10/07/24"
    },
    {
      " Open": 1.3555,
      " High": 1.3592,
      " Low": 1.3543,
      " Close": 1.3576,
      "Date": "10/04/24"
    },
    {
      " Open": 1.3502,
      " High": 1.3561,
      " Low": 1.3497,
      " Close": 1.3556,
      "Date": "10/03/24"
    },
    {
      " Open": 1.3490,
      " High": 1.3512,
      " Low": 1.3474,
      " Close": 1.3503,
      "Date": "10/02/24"
    },
    {
      " Open": 1.3529,
      " High": 1.3541,
      " Low": 1.3481,
      " Close": 1.3494,
      "Date": "10/01/24"
    },
    {
      " Open": 1.3524,
      " High": 1.3539,
      " Low": 1.3490,
      " Close": 1.3526,
      "Date": "09/30/24"
    },
    {
      " Open": 1.3473,
      " High": 1.3529,
      " Low": 1.3464,
      " Close": 1.3518,
      "Date": "09/27/24"
    },
    {
      " Open": 1.3483,
      " High": 1.3503,
      " Low": 1.3458,
      " Close": 1.3465,
      "Date": "09/26/24"
    },
    {
      " Open": 1.3434,
      " High": 1.3492,
      " Low": 1.3419,
      " Close": 1.3484,
      "Date": "09/25/24"
    },
    {
      " Open": 1.3540,
      " High": 1.3545,
      " Low": 1.3431,
      " Close": 1.3432,
      "Date": "09/24/24"
    }
  ];
  
// Format it to remove extra spaces and extract only what we need
let data = list.map(d => ({
  date: d.Date,
  price: d[" Close"]
}));

// Sort by date (oldest to newest)
data.sort((a, b) => new Date(a.date) - new Date(b.date));

// Moving Average calculator
function calculateMA(data, period) {
  let ma = [];
  for (let i = 0; i < data.length; i++) {
    if (i < period - 1) {
      ma.push(null);
    } else {
      let window = data.slice(i - period + 1, i + 1).map(d => d.price);
      let avg = window.reduce((sum, val) => sum + val, 0) / period;
      ma.push(avg);
    }
  }
  return ma;
}

// Extract date and price arrays
let dates = data.map(d => d.date);
let prices = data.map(d => d.price);

// Calculate 5, 8, 13-day MAs
let ma5 = calculateMA(data, 5);
let ma8 = calculateMA(data, 8);
let ma13 = calculateMA(data, 13);

// Lists for crossover points
let buyDates = [];
let buyPrices = [];
let sellDates = [];
let sellPrices = [];

for (let i = 1; i < prices.length; i++) {
  if (ma5[i] && ma8[i] && ma13[i]) {
  const isBullishNow = ma5[i] > ma8[i] && ma8[i] > ma13[i];
  const wasBullishBefore = ma5[i - 1] > ma8[i - 1] && ma8[i - 1] > ma13[i - 1];

  const isBearishNow = ma5[i] < ma8[i] && ma8[i] < ma13[i];
  const wasBearishBefore = ma5[i - 1] < ma8[i - 1] && ma8[i - 1] < ma13[i - 1];

    if (isBullishNow && !wasBullishBefore) {
    buyDates.push(dates[i]);
    buyPrices.push(prices[i]);
    } else if (isBearishNow && !wasBearishBefore) {
    sellDates.push(dates[i]);
    sellPrices.push(prices[i]);
    }
  }
}


// Plotly chart setup
let traces = [
  {
    x: dates,
    y: prices,
    name: 'EUR/USD Price',
    mode: 'lines+markers',
    line: { color: 'black' }
  },
  {
    x: dates,
    y: ma5,
    name: '5-Day MA',
    mode: 'lines',
    line: { color: 'blue' }
  },
  {
    x: dates,
    y: ma8,
    name: '8-Day MA',
    mode: 'lines',
    line: { color: 'orange' }
  },
  {
    x: dates,
    y: ma13,
    name: '13-Day MA',
    mode: 'lines',
    line: { color: 'red' }
  }  
];

//Pushes buy and sell triangle markers to the line chart
traces.push(
  {
    x: buyDates,
    y: buyPrices,
    name: 'BUY Signal',
    mode: 'markers+text',
    marker: { color: 'green', size: 10, symbol: 'triangle-up' },
    text: Array(buyDates.length).fill('BUY'),
    textposition: 'top center'
  },
  {
    x: sellDates,
    y: sellPrices,
    name: 'SELL Signal',
    mode: 'markers+text',
    marker: { color: 'red', size: 10, symbol: 'triangle-down' },
    text: Array(sellDates.length).fill('SELL'),
    textposition: 'bottom center'
  }
);

let layout = {
  title: 'EUR/USD with 5-8-13 Moving Averages',
  xaxis: { title: 'Date' },
  yaxis: { title: 'Price' }
};

// Render chart
Plotly.newPlot('chart', traces, layout);

// Dummy buy/sell signals with calculated returns already
const bullishReturns = [1.2, 0.8, -0.5, 2.1]; // % change from buy to sell
const bearishReturns = [-0.7, 1.5, -0.3];     // % from short to cover

// Calculate averages
const avg = arr => arr.reduce((a, b) => a + b, 0) / arr.length;

// let avgBullish;
// if (bullishReturns.length > 0) {
//   avgBullish = avg(bullishReturns).toFixed(2);
// } else {
//   avgBullish = 0;
// }

// let avgBearish;
// if (bearishReturns.length > 0) {
//   avgBearish = avg(bearishReturns).toFixed(2);
// } else {
//   avgBearish = 0;
// }

const avgBullish = bullishReturns.length ? avg(bullishReturns).toFixed(2) : 0;
const avgBearish = bearishReturns.length ? avg(bearishReturns).toFixed(2) : 0;

// Win/Loss classification
const allReturns = bullishReturns.concat(bearishReturns);
const wins = allReturns.filter(r => r > 0).length;
const losses = allReturns.filter(r => r <= 0).length;

// ðŸ“Š Bar Chart 1: Avg Return After Crossovers
Plotly.newPlot('avgReturnChart', [{
x: ['Bullish Crossover', 'Bearish Crossover'],
y: [avgBullish, avgBearish],
type: 'bar',
marker: { color: ['green', 'red'] }
}], {
title: 'Average Return After Crossovers',
yaxis: { title: 'Return (%)' }
});

// ðŸ“Š Bar Chart 2: Win vs. Loss Count
Plotly.newPlot('winLossChart', [{
x: ['Winning Trades', 'Losing Trades'],
y: [wins, losses],
type: 'bar',
marker: { color: ['green', 'red'] }
}], {
title: 'Win vs. Loss Count',
yaxis: { title: 'Number of Trades' }
});

 //ORIGINAL 
  // // Format it to remove extra spaces and extract only what we need
  // let data = list.map(d => ({
  //   date: d.Date,
  //   price: d[" Close"]
  // }));
  
  // // Sort by date (oldest to newest)
  // data.sort((a, b) => new Date(a.date) - new Date(b.date));
  
  // // Moving Average calculator
  // function calculateMA(data, period) {
  //   let ma = [];
  //   for (let i = 0; i < data.length; i++) {
  //     if (i < period - 1) {
  //       ma.push(null);
  //     } else {
  //       let window = data.slice(i - period + 1, i + 1).map(d => d.price);
  //       let avg = window.reduce((sum, val) => sum + val, 0) / period;
  //       ma.push(avg);
  //     }
  //   }
  //   return ma;
  // }
  
  // // Extract date and price arrays
  // let dates = data.map(d => d.date);
  // let prices = data.map(d => d.price);
  
  // // Calculate 5, 8, 13-day MAs
  // let ma5 = calculateMA(data, 5);
  // let ma8 = calculateMA(data, 8);
  // let ma13 = calculateMA(data, 13);
  
  // // Plotly chart setup
  // let traces = [
  //   {
  //     x: dates,
  //     y: prices,
  //     name: 'CAD/USD Price',
  //     mode: 'lines+markers',
  //     line: { color: 'black' }
  //   },
  //   {
  //     x: dates,
  //     y: ma5,
  //     name: '5-Day MA',
  //     mode: 'lines',
  //     line: { color: 'blue' }
  //   },
  //   {
  //     x: dates,
  //     y: ma8,
  //     name: '8-Day MA',
  //     mode: 'lines',
  //     line: { color: 'orange' }
  //   },
  //   {
  //     x: dates,
  //     y: ma13,
  //     name: '13-Day MA',
  //     mode: 'lines',
  //     line: { color: 'red' }
  //   }
  // ];
  
  // let layout = {
  //   title: 'CAD/USD Moving Averages',
  //   xaxis: { title: 'Date' },
  //   yaxis: { title: 'Price' }
  // };
  
  // // Render chart
  // Plotly.newPlot('chart', traces, layout);